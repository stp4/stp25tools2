% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tbll-desc.R
\name{Tbll_desc}
\alias{Tbll_desc}
\title{Generate Descriptive Statistics Tables}
\usage{
Tbll_desc(
  ...,
  include.label = TRUE,
  include.n = TRUE,
  include.nr = FALSE,
  include.total = FALSE,
  include.test = FALSE,
  include.normality.tests = FALSE,
  include.multiresponse = FALSE,
  include.custom = NULL,
  include.value = NULL,
  include.measure = NULL,
  digits = NULL,
  use.level = 1,
  use.duplicated = FALSE,
  include.prepare.data = FALSE
)
}
\arguments{
\item{...}{A formula specifying variables to analyze and optional grouping variables.
Format: `var1 + var2 ~ group_var` or `var1[measure,digits] + ...`}

\item{include.label}{Logical. Include variable labels in output? Default is TRUE.}

\item{include.n}{Logical. Include counts of valid observations? Default is TRUE.}

\item{include.nr}{Logical or numeric. Include counts only in first row? Default is FALSE.}

\item{include.total}{Logical. Include column for combined groups? Default is FALSE.}

\item{include.test}{Logical or character. Include statistical tests? Can specify test type.
Options: "wilcoxon", "t.test", "anova", etc. Default is FALSE.}

\item{include.normality.tests}{Logical. Include normality tests? Default is FALSE.}

\item{include.multiresponse}{Logical. Handle multiple response variables? Default is FALSE.}

\item{include.custom}{Function. Custom analysis function to apply to each variable.}

\item{include.value}{Vector or data.frame. Additional values to include in output.}

\item{include.measure}{Character. Override default measures for all variables.}

\item{digits}{Numeric. Default decimal places for output.}

\item{use.level}{Numeric. Level for hierarchical variables (default 1).}

\item{use.duplicated}{Logical. Allow duplicate variables? Default is FALSE.}

\item{include.prepare.data}{daten aus prepare_data}
}
\value{
A data.frame containing the formatted results, with attributes for
        caption and notes.
}
\description{
A flexible function for creating descriptive statistics tables with support for
grouping variables, multiple output formats, and custom statistical tests.
}
\details{
The function supports several pre-defined measures:
- "mean": Arithmetic mean with SD
- "median": Median with IQR/range
- "factor": Frequency counts with percentages
- "multi": Multiple response frequencies

Custom measures can be specified using the syntax `var[fun]` where `fun` is
a function that takes a vector and returns a formatted result.
}
\examples{
## ----include = FALSE----------------------------------------------------------
 #knitr::opts_chunk$set(
 # collapse = TRUE,
 # comment = "#>"
 #)

## ----setup, include = FALSE---------------------------------------------------
# library(stp25tools2)

#' ## ----include = FALSE----------------------------------------------------------
set.seed(1)
n <- 100
DF <- data.frame(
  sex = gl(2, n/2, labels = c("male", "female")),
  group = gl(2, n/2, labels = c("Control", "Treat"))[sample.int(n)],
  age = round(runif(n, min = 18, max = 73)),
  bmi = round(runif(n, min = 18, max = 30),1),
  bmi.t1 = rnorm(n),
  bmi.t2 = rnorm(n),
  glucose = round(runif(n, min = 60, max = 110),1),
  harnstoff = round(runif(n, min = 2, max = 8),2),
  crp = c(rep(TRUE, 10), rep(FALSE, n-10))[sample.int(n)]
) |> transform(
  bmi.t1 = round(bmi + bmi.t1,2),
  bmi.t2 = round(bmi + bmi.t2 + as.numeric(sex) -
                   ifelse(bmi > 28, as.numeric(group) * 2, 0) + age/20,1)
) |>
  Label(
    sex= "Geschlecht",
    group = "Behandlung",
    age= "Alter",
    bmi = "BMI (t0)",
    bmi.t1 = "BMI (t1)",
    bmi.t2 = "BMI (t2)",
    glucose= "Glucose",
    harnstoff = "Harnstoff",
    crp = "CRP <10mg/l"
  )

# library(tinyplot)
#
#
# dat<- DF |> Long( bmi + bmi.t1 + bmi.t2 ~ sex + group)
# tinyplot(value ~ group|variable, dat, facet  = ~ sex,  type = "boxplot")

#'

## -----------------------------------------------------------------------------
set_opt(
  mean = list(style=4, plusmin_str=" Â± "),
  median = list(digits=0, style=1),
  percent = list(style=2, null_percent_sign=" . ")
)

## -----------------------------------------------------------------------------
rslt1 <- DF |>
  Tbll_desc(
    sex,
    group,
    age[median,0],
    bmi[median,2],
    "Labor",
    glucose[0],
    harnstoff[2],
    by = ~group,
    include.total = TRUE
  )

## -----------------------------------------------------------------------------
n_mean_sd <- function(x, n, digits, ...) {
  data.frame(
    lev = c("   n", "   mean", "   sd"),
    n = c(as.character(n), "", ""),
    m = c(
      length(x),
      render_f(mean(x, na.rm = TRUE), digits),
      render_f(sd(x, na.rm = TRUE), digits)
    )
  )
}

set_opt(
  measure_fun = list(fun="n_mean_sd"),
  measure = list(fun="factor")
)

## -----------------------------------------------------------------------------
DF |>
  Tbll_desc(
    sex,
    age[median,0],
    bmi[median,2],
    "Labor",
    glucose[0],
    harnstoff[fun],
    crp[multi],
    by = ~group
  )

## -----------------------------------------------------------------------------
Tbll_desc(
  warpbreaks,
  "H1",
  breaks,
  tension,
  by = ~ wool,
  include.value = data.frame(
    ES = 1:2,
    OR = 3:4,
    row.names = c("breaks", "tension")
  )
)

## -----------------------------------------------------------------------------
DF |>
Tbll_desc(
  glucose[0],
  harnstoff[2],
  by = ~ group,
  include.total = TRUE,
  include.test = TRUE,
  include.custom = function(x, by, ...) {
    #dat <- data.frame(x = x, by = by)
    d <- effectsize::cohens_d(x ~ by)
    round(d, 2)[1]
  }
)


}
\seealso{
\code{\link{prepare_data}}, \code{\link{Tbll_desc_grouped}}, \code{\link{Tbll_test}},
 \code{\link[Hmisc]{spearman2}}
}
