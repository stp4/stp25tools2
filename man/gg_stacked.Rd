% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/gg_stacked.R, R/plot_methods.R
\name{gg_stacked}
\alias{gg_stacked}
\alias{plot.stp_multi}
\title{Create stacked bar plots with counts or percentages}
\usage{
gg_stacked(
  data,
  ...,
  facet_formula = NULL,
  include.order = NULL,
  decreasing = TRUE,
  include.reference = NULL,
  palette = "BrBG",
  direction = 1,
  include.value = TRUE,
  include.percent = TRUE,
  labels_size = 3.5,
  labels_color = c("black", "gray95"),
  labels_hide_below = 0.05,
  wrap = 40,
  width = 0.9,
  border = NA,
  item_levels = NULL
)

\method{plot}{stp_multi}(x, ...)
}
\arguments{
\item{data}{Ein `data.frame` oder `tibble`, das mindestens die Variablen
für die Kategorien (`x`), die Häufigkeiten (`weight`) und die Füllfarben (`fill`) enthält.}

\item{...}{Optional ästhetische Mappings:
- `x` : Kategorische Variable (Default: `"Item"`, falls vorhanden).
- `weight` : Gewichtungsvariable, meist Häufigkeiten (Default: `"Freq"`).
- `fill` : Gruppierungsvariable für die Balkensegmente (Default: `"levels"`).
- `grouping` : Optionale Variable zur Bildung von Facetten (Default: `".grouping"`).}

\item{facet_formula}{Eine Facetten-Formel für [ggplot2::facet_grid()].
Wird automatisch aus `grouping` abgeleitet, falls angegeben.}

\item{include.order}{Optionaler Vektor zur Steuerung der Reihenfolge der Items.}

\item{decreasing}{`logical`. Wenn `TRUE` (Default), werden Items absteigend sortiert.}

\item{include.reference}{Optional: Referenzlevel, das immer einbezogen wird.}

\item{palette}{Farbpalette für die Segmente, weitergereicht an
[ggplot2::scale_fill_brewer()]. Standard `"BrBG"`.}

\item{direction}{Richtung der Farbskala (`1` oder `-1`).}

\item{include.value}{`logical`. Ob Werte als Textlabels angezeigt werden. Default `TRUE`.}

\item{include.percent}{`logical`. Ob relative Häufigkeiten (Prozent) angezeigt werden.
Falls `FALSE`, werden absolute Häufigkeiten gezeigt.}

\item{labels_size}{Textgröße für Labels.}

\item{labels_color}{Zeichenkette oder Vektor mit Farben für die Labels.
Default: `c("black", "gray95")`.}

\item{labels_hide_below}{Schwellenwert (0–1). Labels für Segmente mit
kleineren Anteilen werden ausgeblendet. Default `0.05`.}

\item{wrap}{Numerisch. Falls angegeben, werden lange Faktorlevels
umgebrochen}

\item{width}{Balkenbreite (Default `0.90`).}

\item{item_levels}{Optional: Vektor mit expliziter Reihenfolge der Items.}

\item{x}{stp25likert-Objekt}
}
\value{
Ein `ggplot`-Objekt mit horizontalen, gestapelten Balken.
}
\description{
`gg_stacked()` ist ein flexibler Wrapper um [ggplot2::geom_bar()],
mit Erweiterungen für Häufigkeitstabellen im „long“-Format.
Es werden automatisch Standardspalten wie `Item`, `Freq`, `levels`
oder `.grouping` erkannt, können aber auch manuell über Argumente
angegeben werden. Optional lassen sich Facetten, Reihenfolgen und
Labels (Zahlen oder Prozente) steuern.
}
\details{
- Prozentdarstellung (`include.percent = TRUE`) nutzt `ggstats::StatProp`.
- Absolute Häufigkeiten (`include.percent = FALSE`) nutzen `stat = "count"`.
- Falls eine Gruppierungsvariable angegeben ist, werden die Items
  gruppenspezifisch mit [tidytext::reorder_within()] sortiert.
}
\examples{
library(tibble)
library(ggplot2)

# Beispiel mit Standardspalten
DF <- tibble(
  id = 1:6,
  .grouping = rep("Domain A", 6),
  Sex = rep(c("female","male"), 3),
  Item = factor(rep(c("Fruit", "Vegetables", "Milk"), each = 2)),
  levels = rep(c(TRUE, FALSE), 3),
  Freq = c(20,10, 15,25, 30,12)
)

gg_stacked(DF)

# Mit eigenen Spaltennamen und Facettierung
DF2 <- DF
names(DF2) <- c("id", "food_group", "Sex", "Frage", "factor_levels", "Anzahl")

gg_stacked(
  DF2,
  x = Frage,
  weight = Anzahl,
  fill = factor_levels,
  grouping = food_group,
  facet_formula = food_group ~ Sex
)

}
\seealso{
[ggplot2::geom_bar()], [tidytext::reorder_within()]
}
